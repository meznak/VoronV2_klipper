## Voron Design VORON2 350mm 
## =========================
## Dual SKR 1.3 Controllers
## TMC2209 (UART mode) Drivers

[printer]
kinematics: corexy
max_velocity: 300
max_accel: 3000            #Max 4000
max_z_velocity: 15         #Max 15 for 12V TMC Drivers, can increase for 24V
max_z_accel: 350           #Max ?
square_corner_velocity: 5.0  #Can experiment with 8.0, default 5.0


#####################################################################
#  Microcontroller Definitions
#####################################################################

## MCU for X/Y/E steppers (main MCU)
[mcu]
serial: /dev/serial/by-path/platform-fd500000.pcie-pci-0000:01:00.0-usb-0:1.4:1.0
restart_method: command

## MCU for Z steppers
[mcu z]
serial: /dev/serial/by-path/platform-fd500000.pcie-pci-0000:01:00.0-usb-0:1.3:1.0
restart_method: command


#####################################################################
# 	Stepper Settings
#####################################################################

## Connected to X on mcu_xye (B Motor)
[stepper_x]
step_pin: P2.2
dir_pin: !P2.6
enable_pin: !P2.1
step_distance: 0.0125
endstop_pin: !P1.28
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 25   #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_x]
uart_pin: P1.17
microsteps: 16
interpolate: True
run_current: 0.8
hold_current: 0.7
sense_resistor: 0.110
stealthchop_threshold: 0


## Connected to Y on mcu_xye (A Motor)
[stepper_y]
step_pin: P0.19
dir_pin: !P0.20
enable_pin: !P2.8
step_distance: 0.0125
endstop_pin: !P1.26
position_min: 0
position_endstop: 350
position_max: 350
homing_speed: 25  #Max 100
homing_retract_dist: 5
homing_positive_dir: true

[tmc2209 stepper_y]
uart_pin: P1.15
microsteps: 16
interpolate: True
run_current: 0.8  #~90% of RMS Current Max
hold_current: 0.7 # Marlin uses 50% of Max
sense_resistor: 0.110
stealthchop_threshold: 0 #250


## Z MCU - In X Position
## Z0 Stepper - Front Left
[stepper_z]
step_pin: z:P2.2
dir_pin: !z:P2.6
enable_pin: !z:P2.1
step_distance: 0.00250
endstop_pin: z:P1.25
##  Z-position of nozzle (in mm) to z-endstop trigger point relative to print surface (Z0)
##  (+) value = endstop above Z0, (-) value = endstop below
##	Increasing position_endstop brings nozzle closer to the bed
##  After you run Z_ENDSTOP_CALIBRATE, position_endstop will be stored at the very end of your config
position_endstop: -0.5
position_max: 340
position_min: -5
homing_speed: 15.0
second_homing_speed: 3.0
homing_retract_dist: 3.0

[tmc2209 stepper_z]
uart_pin: z:P1.17
microsteps: 16
interpolate: true
run_current: 0.8
hold_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z MCU - In Y Position
##	Z1 Stepper - Rear Left
[stepper_z1]
step_pin: z:P0.19
dir_pin: z:P0.20
enable_pin: !z:P2.8
step_distance: 0.00250

[tmc2209 stepper_z1]
uart_pin: z:P1.15
microsteps: 16
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z MCU - In Z Position
##	Z2 Stepper - Rear Right
[stepper_z2]
step_pin: z:P0.22
dir_pin: !z:P2.11
enable_pin: !z:P0.21
step_distance: 0.00250

[tmc2209 stepper_z2]
uart_pin: z:P1.10
microsteps: 16
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0


##	Z MCU - In E0 Position
##	Z3 Stepper - Front Right
[stepper_z3]
step_pin: z:P2.13
dir_pin: z:P0.11
enable_pin: !z:P2.12
step_distance: 0.00250

[tmc2209 stepper_z3]
uart_pin: z:P1.8
microsteps: 16
interpolate: true
run_current: 0.8
hold_current: 0.80
sense_resistor: 0.110
stealthchop_threshold: 0 #30


#####################################################################
# 	Extruder
#####################################################################

#	E0 on MCU X/Y
#[extruder]
#step_pin: P2.13
#dir_pin: P0.11
#enable_pin: !P2.12
###	If you ask for 100mm of filament, but in reality it is 98mm:
###	step_distance = 98 / 100 * step_distance_old
###  0.00240 a good starting value for Afterburner, 0.00180 for Mobius
#step_distance: 0.00240
#nozzle_diameter: 0.400
#filament_diameter: 1.75
#heater_pin: P2.7
###	Validate the following thermistor type to make sure it is correct
#sensor_type: ATC Semitec 104GT-2
#sensor_pin: P0.24
#min_temp: 10
#max_temp: 270
#max_power: 1.0
#min_extrude_temp: 170
#control = pid
#pid_kp = 26.213
#pid_ki = 1.304
#pid_kd = 131.721
###	Try to keep pressure_advance below 1.0
#pressure_advance: 0.05
###	Default is 0.040, leave stock
#pressure_advance_smooth_time: 0.040

###	E0 on MCU X/Y
#[tmc2209 extruder]
#uart_pin: P1.9
#microsteps: 16
#interpolate: false
#run_current: 0.5
#hold_current: 0.4
#sense_resistor: 0.110
#stealthchop_threshold: 0 #5


#####################################################################
# 	Bed Heater
#####################################################################

##   SSR Pin - Z board, Fan
#[heater_bed]
#heater_pin: z:P2.3
#sensor_type: NTC 100K MGB18-104F39050L32
#sensor_pin: z:P0.23
##	Adjust Max Power so your heater doesn't warp your bed
#max_power: 0.6
#min_temp: 0
#max_temp: 120
#control: pid
#pid_kp: 58.437
#pid_ki: 2.347
#pid_kd: 363.769


#####################################################################
# 	Fan Control
#####################################################################

##   Hotend Fan - XYE board, HE1
#[heater_fan hotend_fan]
#pin: P2.4
#max_power: 1.0
#kick_start_time: 0.5
#heater: extruder
#heater_temp: 50.0
##	If you are experiencing back flow, you can reduce fan_speed
#fan_speed: 1.0

##   Print Cooling Fan - XYE board, Fan
[fan]
pin: P2.3
kick_start_time: 0.5
#	Depending on your fan, you may need to increase this value
#	if your fan will not start. Can change cycle_time (increase)
#	if your fan is not able to slow down effectively
off_below: 0.10

###   Controller cooling fan - XYE board, BED
#[controller_fan XYE]
#pin: P2.5
#kick_start_time: 0.5
#idle_timeout: 60
#heater: extruder

###   Controller cooling fan - Z board, BED
#[controller_fan Z]
#pin: z:P2.5
#kick_start_time: 0.5
#idle_timeout: 60
#heater: heater_bed

###   Exhaust fan - Z board, HE0
#[heater_fan exhaust_fan]
#pin: z:P2.7
#max_power: 1.0
#shutdown_speed: 0.0
#kick_start_time: 5.0
#heater: heater_bed
#heater_temp: 60
#fan_speed: 1.0


#####################################################################
# Other Sensors
#####################################################################

###   Chamber Temp Sensor - Z Board, TH0
#[temperature_sensor chamber]
#sensor_type: EPCOS 100K B57560G104F
#sensor_pin: z:P2.4
#gcode_id: C

###   Rasberry Pi CPU Temperature
#[temperature_sensor cpu]
#sensor_type: rpi_temperature


#####################################################################
# 	Lighting Control
#####################################################################

###   Chamber Lighting - Z Board, BED
#[output_pin caselight]
#pin: P2.5
#max_power: 1.0
#pwm:true
#shutdown_value: 0
#value:100
#cycle_time: 0.01
#scale: 100


#####################################################################
# 	Display
#####################################################################

##   Fysetc Mini 12864 Display (V2.1)
##   https://wiki.fysetc.com/Mini12864_Panel/
[display]
lcd_type: uc1701
cs_pin: z:P1.18
a0_pin: z:P1.19
encoder_pins: ^z:P3.25,^z:P3.26
click_pin: ^!z:P0.28
contrast: 63
display_group: __voron_display

##   Neopixel interface on Mini 12864 Display
[neopixel fysetc_mini12864]
pin: z:P1.21
chain_count: 3
initial_RED: 0.1
initial_GREEN: 0.5
initial_BLUE: 0.0
color_order: RGB

#	Set RGB values on boot up for each Neopixel. 
#	Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=2 TRANSMIT=0
        SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=3

[output_pin BEEPER_pin]
pin: z:P1.30
pwm: true
value: 0
shutdown_value: 0
cycle_time: 0.001
scale: 1000


#####################################################################
#  Advanced Features
#####################################################################

###   Input Shaping
#[input_shaper]
#shaper_freq_x: 0
#   A frequency (in Hz) of the input shaper for X axis. This is usually a
#   resonance frequency of X axis that the input shaper should suppress.
#   For more complex shapers, like 2- and 3-hump EI input shapers, this
#   parameter can be set from different considerations.
#   The default value is 0, which disables input shaping for X axis.
#shaper_freq_y: 0
#   A frequency (in Hz) of the input shaper for Y axis. This is usually a
#   resonance frequency of Y axis that the input shaper should suppress.
#   For more complex shapers, like 2- and 3-hump EI input shapers, this
#   parameter can be set from different considerations.
#   The default value is 0, which disables input shaping for Y axis.
#shaper_type: mzv
#   A type of the input shaper to use for both X and Y axes. Supported shapers
#   are zv, mzv, zvd, ei, 2hump_ei, and 3hump_ei.
#   The default is mzv input shaper.
#shaper_type_x:
#shaper_type_y:
#   If shaper_type is not set, these two parameters can be used to configure
#   different input shapers for X and Y axes. The same values are supported
#   as for shaper_type parameter.
#damping_ratio_x: 0.1
#damping_ratio_y: 0.1
#   Damping ratios of vibrations of X and Y axes used by input shapers to
#   improve vibration suppression. Should not be changed without some proper
#   measurements, e.g. with an accelerometer.
#   Default value is 0.1 which is a good all-round value for most printers.


###   Filament Runout Sensor - XYE Board, Z+
#[filament_switch_sensor filament_sensor]
#pause_on_runout: True
#switch_pin: ^!P1.24
#insert_gcode:
#    M117 Insert Detected
#runout_gcode:
#    M117 Runout Detected
#    M600
#    M400
